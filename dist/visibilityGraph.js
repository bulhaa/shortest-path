!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(exports):typeof define==='function'&&define.amd?define(['exports'],b):(a=a||self, b(a.visibilityGraph={}))}(this,function(d){'use strict';var e=function(a){g(a);var b=f(a);a.on=b.on;a.off=b.off;a.fire=b.fire;return a};function f(a){var b=Object.create(null);return{on:function(c,d,e){if(typeof d!=='function'){throw new Error('callback is expected to be a function')}var f=b[c];f||(f=b[c]=[]);f.push({callback:d,ctx:e});return a},off:function(c,d){var e=typeof c==='undefined';if(e){b=Object.create(null);return a}if(b[c]){var f=typeof d!=='function';if(f)delete b[c];else{var g=b[c];for(var h=0;h<g.length;++h)g[h].callback===d&&g.splice(h,1)}}return a},fire:function(c){var d=b[c];if(!d){return a}var e;arguments.length>1&&(e=Array.prototype.splice.call(arguments,1));for(var f=0;f<d.length;++f){var g=d[f];g.callback.apply(g.ctx,e)}return a}}}function g(a){if(!a){throw new Error('Eventify cannot use falsy object as events subject')}var b=['on','fire','off'];for(var c=0;c<b.length;++c){if(a.hasOwnProperty(b[c])){throw new Error("Subject cannot be eventified, since it already has property '"+b[c]+"'")}}}var h=i;function i(a){a=a||{};'uniqueLinkId' in a&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",'\n',"Note: there is also change in default behavior: From now on each graph\nis considered to be not a multigraph by default (each edge is unique)."),a.multigraph=a.uniqueLinkId);a.multigraph===undefined&&(a.multigraph=!1);var b=typeof Object.create==='function'?Object.create(null):{},c=[],d={},f=0,g=0,h=O(),i=a.multigraph?C:B,o=[],p=L,q=L,r=L,s=L,t={addNode:x,addLink:A,removeLink:E,removeNode:z,getNode:y,getNodesCount:function(){return f},getLinksCount:function(){return c.length},getLinks:D,forEachNode:h,forEachLinkedNode:I,forEachLink:H,beginUpdate:r,endUpdate:s,clear:G,hasLink:F,hasNode:y,getLink:F};e(t);u();return t;function u(){var a=t.on;t.on=b;function b(){t.beginUpdate=r=M;t.endUpdate=s=N;p=v;q=w;t.on=a;return a.apply(t,arguments)}}function v(a,b){o.push({link:a,changeType:b})}function w(a,b){o.push({node:a,changeType:b})}function x(a,c){if(a===undefined){throw new Error('Invalid node identifier')}r();var d=y(a);d?(d.data=c,q(d,'update')):(d=new k(a,c),f++,q(d,'add'));b[a]=d;s();return d}function y(a){return b[a]}function z(a){var c=y(a);if(!c){return !1}r();var d=c.links;if(d){c.links=null;for(var e=0;e<d.length;++e)E(d[e])}delete b[a];f--;q(c,'remove');s();return !0}function A(a,b,d){r();var e=y(a)||x(a),f=y(b)||x(b),g=i(a,b,d);c.push(g);l(e,g);a!==b&&l(f,g);p(g,'add');s();return g}function B(a,b,c){var d=n(a,b);return new m(a,b,c,d)}function C(a,b,c){var e=n(a,b),f=d.hasOwnProperty(e);if(f||F(a,b)){f||(d[e]=0);var g='@'+ ++d[e];e=n(a+g,b+g)}return new m(a,b,c,e)}function D(a){var b=y(a);return b?b.links:null}function E(a){if(!a){return !1}var b=j(a,c);if(b<0){return !1}r();c.splice(b,1);var d=y(a.fromId),e=y(a.toId);d&&(b=j(a,d.links),b>=0&&d.links.splice(b,1));e&&(b=j(a,e.links),b>=0&&e.links.splice(b,1));p(a,'remove');s();return !0}function F(a,b){var c=y(a),d;if(!c||!c.links){return null}for(d=0;d<c.links.length;++d){var e=c.links[d];if(e.fromId===a&&e.toId===b){return e}}return null}function G(){r();h(function(a){z(a.id)});s()}function H(a){var b,d;if(typeof a==='function'){for(b=0, d=c.length;b<d;++b)a(c[b])}}function I(a,b,c){var d=y(a);if(d&&d.links&&typeof b==='function'){if(c){return K(d.links,a,b)}else{return J(d.links,a,b)}}}function J(a,c,d){var e;for(var f=0;f<a.length;++f){var g=a[f],h=g.fromId===c?g.toId:g.fromId;e=d(b[h],g);if(e){return !0}}}function K(a,c,d){var e;for(var f=0;f<a.length;++f){var g=a[f];if(g.fromId===c){e=d(b[g.toId],g);if(e){return !0}}}}function L(){}function M(){g+=1}function N(){g-=1;g===0&&o.length>0&&(t.fire('changed',o),o.length=0)}function O(){return Object.keys?P:Q}function P(a){if(typeof a!=='function'){return}var c=Object.keys(b);for(var d=0;d<c.length;++d){if(a(b[c[d]])){return !0}}}function Q(a){if(typeof a!=='function'){return}var c;for(c in b){if(a(b[c])){return !0}}}}function j(a,b){if(!b)return-1;if(b.indexOf){return b.indexOf(a)}var c=b.length,d;for(d=0;d<c;d+=1){if(b[d]===a){return d}}return-1}function k(a,b){this.id=a;this.links=null;this.data=b}function l(a,b){a.links?a.links.push(b):(a.links=[b])}function m(a,b,c,d){this.fromId=a;this.toId=b;this.data=c;this.id=d}function n(a,b){return a.toString()+'ðŸ‘‰ '+b.toString()}class o{constructor(){this.keys=[]}findKeyPosition(a,b){let c=0,d=this.keys.length;while(c<d){let b=Math.floor((c+d)/2);a.isLessThanOtherEdgeKey(this.keys[b])?(d=b):(c=b+1)}return c}addKey(a,b){let c=this.findKeyPosition(a);this.keys.splice(c,0,a)}}class s{constructor(a,b){b===null&&(b=-1);this.x=a[0];this.y=a[1];this.polygonID=b;this.edges=[];this.prevPoint=null;this.nextPoint=null}isPointEqual(a){return this.x===a.x&&this.y===a.y}angleToPoint(a){if(this.isPointEqual(a))return 0;let b=a.x-this.x,c=a.y-this.y;c===0&&(b<0?Math.PI:0);if(b<0)return Math.PI+Math.atan(c/b);if(c<0)return 2*Math.PI+Math.atan(c/b);return Math.atan(c/b)}}let v=10000,w=13,x=Math.pow(10,w),y=Math.pow(10.0,w);function z(a,b,c){let d=c.p1,e=c.p2,f=A(a,b,d),g=A(a,b,e),h=A(d,e,a),i=A(d,e,b);if(f!==g&&h!==i)return !0;if(f===0&&B(a,d,b))return !0;if(g===0&&B(a,e,b))return !0;if(h===0&&B(d,a,e))return !0;if(i===0&&B(d,b,e))return !0;return !1}function A(a,b,c){let d=Math.round(((b.x-a.x)*(c.y-a.y)-(b.y-a.y)*(c.x-a.x))*x)/y;if(d>0)return 1;if(d<0)return-1;return 0}function B(a,b,c){if(b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)){if(b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y))return !0}return !1}function C(a,b,c){let d=Math.pow((c.x-b.x),2)+Math.pow((c.y-b.y),2),e=Math.pow((c.x-a.x),2)+Math.pow((c.y-a.y),2),f=Math.pow((b.x-a.x),2)+Math.pow((b.y-a.y),2);return Math.acos((d+f-e)/(2*Math.sqrt(d)*Math.sqrt(f)))}function D(a,b,c){let d=E(a,b,c);return d!==null?F(a,d):0}function E(a,b,c){if(c.containsPoint(a))return a;if(c.containsPoint(b))return b;if(c.p1.x===c.p2.x){if(a.x===b.x)return null;let d=(a.y-b.y)/(a.x-b.x),e=c.p1.x,f=d*(e-a.x)+a.y;return new s([e,f],null)}if(a.x===b.x){let b=(c.p1.y-c.p2.y)/(c.p1.x-c.p2.x),d=a.x,e=b*(d-c.p1.x)+c.p1.y;return new s([d,e],null)}let d=(a.y-b.y)/(a.x-b.x),e=(c.p1.y-c.p2.y)/(c.p1.x-c.p2.x);if(d===e)return null;let f=(e*c.p1.x-d*a.x+a.y-c.p1.y)/(e-d),g=e*(f-c.p1.x)+c.p1.y;return new s([f,g],null)}function F(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}class G{constructor(a,b,c){this.p1=a;this.p2=b;this.edge=c}isLessThanOtherEdgeKey(a){if(this.matchesOtherKey(a))return !1;if(!z(this.p1,this.p2,a.edge))return !0;let b=D(this.p1,this.p2,this.edge),c=D(this.p1,this.p2,a.edge);if(b>c)return !1;if(b<c)return !0;if(b===c){let b=null;a.edge.containsPoint(this.edge.p1)?(b=this.edge.p1):(b=this.edge.p2);let c=C(this.p1,this.p2,this.edge.getOtherPointInEdge(b)),d=C(this.p1,this.p2,a.edge.getOtherPointInEdge(b));if(c<d)return !0;return !1}}matchesOtherKey(a){return this.edge.areEdgesEqual(a.edge)}}class H{constructor(a,b){this.p1=a;this.p2=b;a.edges.push(this);b.edges.push(this)}getOtherPointInEdge(a){return this.p1.isPointEqual(a)?this.p2:this.p1}areEdgesEqual(a){if(this.p1.isPointEqual(a.p1)&&this.p2.isPointEqual(a.p2))return !0;if(this.p1.isPointEqual(a.p2)&&this.p2.isPointEqual(a.p1))return !0;return !1}containsPoint(a){if(this.p1.isPointEqual(a)||this.p2.isPointEqual(a))return !0;return !1}}function I(a,b,c,d){let e=a.type==='Feature'?a.geometry:a,f=e.coordinates;e.type==='Polygon'&&(f=[f]);for(let a=0;a<f.length;a++){let e=[];d.push(e);for(let d=0;d<f[a].length;d++){let g=new s(f[a][d][0],a),h=new s(f[a][d][1],a);g.nextPoint=h;let i=new s(f[a][d][2],a);J(g,h,i);c.push(g);let j=new H(g,h);b.push(j);e.push(j);let k=g;g=h;h=i;for(let k=2;k<f[a][d].length-2;k++){c.push(g);i=new s(f[a][d][k+1],a);J(g,h,i);let l=new H(g,h);b.push(l);e.push(l);g=h;h=i;j=l}J(g,h,k);let l=new H(j.p2,h);b.push(l);e.push(l);let m=new H(h,k);J(h,k,k.nextPoint);b.push(m);e.push(m);c.push(g);c.push(i)}}}function J(a,b,c){b.prevPoint=a;b.nextPoint=c}function K(a){let b=[],c=[],d=[];I(a,c,b,d);return e();function e(){let a=h(),d=b.length,e=g();for(var k=0;k<d;k++){let g=b[k],h=g.prevPoint,m=g.nextPoint;i(g,e);let n=new o(),p=new s([v,g.y],null);for(let a=0;a<d;a++){let b=c[a];if(b.containsPoint(g))continue;if(z(g,p,b)){if(B(g,b.p1,p)||B(g,b.p2,p))continue;n.addKey(new G(g,p,b))}}let q=[],r=null,t=null;for(let a=0;a<d;a++){let b=e[a];if(b.isPointEqual(g))continue;if(g.angleToPoint(b)>Math.pi)break;if(n.keys.length>0){for(let a=0;a<b.edges.length;a++){let c=b.edges[a];if(A(g,b,c.getOtherPointInEdge(b))===-1){let a=new G(g,b,c),d=n.findKeyPosition(a)-1;d!==-1&&n.keys[d].matchesOtherKey(a)&&n.keys.splice(d,1)}}}let c=!1;if(r===null||A(g,r,b)!==0||!B(g,r,b))n.keys.length===0?(c=!0):z(g,b,n.keys[0].edge)||(c=!0);else if(!t)c=!1;else{c=!0;for(let a=0;a<n.keys.length;a++){let d=n.keys[a];if(!d.edge.containsPoint(r)&&z(r,b,d.edge)){c=!1;break}}c&&j(r,b)&&(c=!1)};let f=b.isPointEqual(h)||b.isPointEqual(m);c&&!f&&(c=!j(g,b));c&&q.push(b);for(let a=0;a<b.edges.length;a++){let c=b.edges[a];if(!c.containsPoint(g)&&A(g,b,c.getOtherPointInEdge(b))===1){let a=new G(g,b,c);n.addKey(a)}}r=b;t=c}let u=f(g);a.addNode(u,{x:g.x,y:g.y});for(var l=0;l<q.length;l++){let b=f(q[l]);a.addNode(b,{x:q[l].x,y:q[l].y});a.addLink(u,b)}}return a}function f(a){return a.x+','+a.y}function g(){return b.slice(0)}function i(a,b){b.sort((b,c)=>{let d=a.angleToPoint(b),e=a.angleToPoint(c);if(d<e)return-1;if(d>e)return 1;let f=F(a,b),g=F(a,c);if(f<g)return-1;if(f>g)return 1;return 0})}function j(a,b){if(a.polygonID!==b.polygonID)return !1;if(a.polygonID===-1||b.polygonID===-1)return !1;let c=new s([(a.x+b.x)/2,(a.y+b.y)/2],null);return k(c,d[a.polygonID])}function k(a,b){let c=new s([v,a.y],null),d=0,e=!1,f=0;for(let g=0;g<b.length;g++){let h=b[g];if(a.y<h.p1.y&&a.y<h.p2.y)continue;if(a.y>h.p1.y&&a.y>h.p2.y)continue;let i=A(a,h.p1,c)===0&&h.p1.x>a.x,j=A(a,h.p2,c)===0&&h.p2.x>a.x,k=i?h.p1:h.p2;i||j?(f=h.getOtherPointInEdge(k).y>a.y?f++:f--,e?(f===0&&d++,e=!1,f=0):(e=!0)):z(a,c,h)&&d++}if(d%2===0)return !1;return !0}}d.createGraphFromGeoJson=K;Object.defineProperty(d,'__esModule',{value:!0})})
